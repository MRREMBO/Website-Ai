<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Futuristic AI Studio — Chat & Image</title>
  <meta name="description" content="AI Chat + Image generator — futuristic UI. Deploy to Vercel and set OPENAI_API_KEY in Environment Variables."/>
  <style>
    /* Futuristic glass/neon aesthetic */
    :root{
      --bg:#030312; --card:rgba(255,255,255,0.03); --glass: rgba(255,255,255,0.04);
      --accent:#7c3aed; --accent2:#00e5ff; --muted: #9ca3af; --success:#10b981;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:#e6eef8;background:radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.12), transparent), radial-gradient(1000px 500px at 90% 90%, rgba(0,229,255,0.06), transparent), var(--bg);-webkit-font-smoothing:antialiased;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:1100px;border-radius:18px;padding:18px;background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));backdrop-filter:blur(8px);box-shadow:0 10px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03);display:grid;grid-template-columns:1fr 420px;gap:18px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    h1{margin:0;font-size:20px;letter-spacing:0.2px}
    .left .chat{height:520px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);padding:14px;border-radius:12px;overflow:auto;border:1px solid rgba(255,255,255,0.02)}
    .row{display:flex;gap:8px;align-items:center}
    .controls{display:flex;gap:8px;align-items:center}
    .input, textarea{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text);font-size:15px;outline:none}
    .btn{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:white;padding:10px 14px;border-radius:10px;cursor:pointer;box-shadow:0 6px 20px rgba(124,58,237,0.16);font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .msg{margin-bottom:12px;padding:10px;border-radius:10px;max-width:80%}
    .msg.user{margin-left:auto;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
    .msg.assistant{background:linear-gradient(180deg, rgba(0,229,255,0.04), rgba(124,58,237,0.03));border:1px solid rgba(0,229,255,0.06)}
    .right .panel{background:var(--card);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    .img-wrap{height:360px;border-radius:10px;overflow:hidden;background:linear-gradient(180deg,#021024,#08122a);display:flex;align-items:center;justify-content:center;color:var(--muted);border:1px solid rgba(255,255,255,0.02)}
    img.generated{width:100%;height:100%;object-fit:cover;display:block}
    .loader{width:60px;height:60px;border-radius:999px;position:relative;margin:auto}
    .loader:before,.loader:after{content:'';position:absolute;inset:0;border-radius:999px}
    .loader:before{background:conic-gradient(from 0deg, rgba(255,255,255,0.06), transparent 40%)}
    .loader:after{inset:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent)}
    footer{margin-top:12px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center}
    .meta small{color:var(--muted)}
    .download{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
    @media (max-width:980px){ .card{grid-template-columns:1fr;max-width:740px} .left .chat{height:300px}.img-wrap{height:220px} }
  </style>
</head>
<body>
  <div class="card">
    <div class="left">
      <header>
        <h1>Futuristic AI Studio</h1>
        <div class="controls">
          <button id="themeBtn" class="btn ghost">Toggle Theme</button>
          <button id="clearChat" class="btn ghost">Clear</button>
        </div>
      </header>

      <div class="chat" id="chatArea" aria-live="polite">
        <div class="msg assistant"><strong>Assistant</strong><div style="opacity:0.85"> Hello — try asking something or generate an image from the right panel.</div></div>
      </div>

      <div style="margin-top:10px" class="row">
        <input id="chatInput" class="input" placeholder="Type message and press Enter (e.g. Explain neural networks in simple words)">
        <button id="sendBtn" class="btn">Send</button>
      </div>

      <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
        <div id="chatStatus" style="color:var(--muted);font-size:13px"></div>
        <div style="font-size:12px;color:var(--muted)">Model: <strong style="color:#cbd5e1">gpt-4o-mini</strong></div>
      </div>
    </div>

    <div class="right">
      <div class="panel">
        <h2 style="margin:0 0 8px 0">Image Generator</h2>
        <input id="imgPrompt" class="input" placeholder="e.g. Cyberpunk fox flying above neon city, cinematic, 4k" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="genBtn" class="btn">Generate</button>
          <button id="downloadBtn" class="download">Download</button>
          <button id="clearImg" class="btn ghost">Clear</button>
        </div>

        <div style="margin-top:12px" class="img-wrap" id="imgWrap">
          <div style="text-align:center;color:var(--muted)">Generated image will appear here</div>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div class="meta"><small>Proxy: <code>/api/generate</code></small></div>
          <div id="imgStatus" style="color:var(--muted);font-size:13px"></div>
        </div>
      </div>

      <footer>
        <div style="font-size:12px;color:var(--muted)">Deploy: Vercel — set <code>OPENAI_API_KEY</code> in Project Environment</div>
        <div></div>
      </footer>
    </div>
  </div>

<script>
// Frontend behavior: chat + image generation via /api/generate
const chatArea = document.getElementById('chatArea');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const chatStatus = document.getElementById('chatStatus');
const genBtn = document.getElementById('genBtn');
const imgPrompt = document.getElementById('imgPrompt');
const imgWrap = document.getElementById('imgWrap');
const imgStatus = document.getElementById('imgStatus');
const downloadBtn = document.getElementById('downloadBtn');
const clearImg = document.getElementById('clearImg');
const clearChat = document.getElementById('clearChat');
const themeBtn = document.getElementById('themeBtn');

let lastImage = null;

function appendMessage(role, text){
  const div = document.createElement('div');
  div.className = 'msg ' + (role==='user' ? 'user' : 'assistant');
  div.innerHTML = '<strong>' + (role==='user' ? 'You' : 'Assistant') + '</strong><div style="opacity:0.9;margin-top:6px">' + text + '</div>';
  chatArea.appendChild(div);
  chatArea.scrollTop = chatArea.scrollHeight;
}

sendBtn.addEventListener('click', sendChat);
chatInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') sendChat(); });

async function sendChat(){
  const prompt = chatInput.value.trim();
  if(!prompt) return;
  appendMessage('user', prompt);
  chatInput.value='';
  chatStatus.textContent = 'Sending…';
  try{
    const resp = await fetch('/api/generate', {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ chat: true, prompt })
    });
    if(!resp.ok){
      const txt = await resp.text();
      throw new Error('Server error: ' + txt);
    }
    const data = await resp.json();
    appendMessage('assistant', data.reply || 'No reply');
    chatStatus.textContent = 'Done';
  }catch(err){
    appendMessage('assistant', '<span style="color:#ffb4b4">Error: '+err.message+'</span>');
    chatStatus.textContent = 'Error';
  }
}

// Image generation
genBtn.addEventListener('click', generateImage);
imgPrompt.addEventListener('keydown', (e)=>{ if(e.key==='Enter') generateImage(); });

async function generateImage(){
  const prompt = imgPrompt.value.trim();
  if(!prompt) return alert('Please enter an image description.');
  imgWrap.innerHTML = '<div class="loader" aria-hidden="true"></div>';
  imgStatus.textContent = 'Generating…';
  try{
    const resp = await fetch('/api/generate', {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ chat: false, prompt })
    });
    if(!resp.ok){
      const txt = await resp.text();
      throw new Error('Server error: ' + txt);
    }
    const data = await resp.json();
    let url = data.image_url || (data.data && data.data[0] && ('data:image/png;base64,' + data.data[0].b64_json)) || data.url;
    if(!url) throw new Error('No image URL returned.');
    lastImage = url;
    imgWrap.innerHTML = `<img class="generated" src="${url}" alt="AI image">`;
    imgStatus.textContent = 'Done';
  }catch(err){
    imgWrap.innerHTML = '<div style="color:#ffb4b4">Failed to generate image</div>';
    imgStatus.textContent = 'Error';
    console.error(err);
  }
}

downloadBtn.addEventListener('click', ()=>{
  if(!lastImage) return alert('No image to download.');
  const a = document.createElement('a');
  a.href = lastImage;
  a.download = 'ai-image.png';
  document.body.appendChild(a);
  a.click();
  a.remove();
});

clearImg.addEventListener('click', ()=>{
  imgPrompt.value='';
  imgWrap.innerHTML = '<div style="text-align:center;color:#9ca3af">Generated image will appear here</div>';
  imgStatus.textContent = '';
  lastImage = null;
});

clearChat.addEventListener('click', ()=>{
  chatArea.innerHTML = '<div class="msg assistant"><strong>Assistant</strong><div style="opacity:0.85"> Hello — try asking something or generate an image from the right panel.</div></div>';
});

themeBtn.addEventListener('click', ()=>{
  document.documentElement.classList.toggle('alt-theme');
  document.body.style.background = document.documentElement.classList.contains('alt-theme') ? 'radial-gradient(1200px 600px at 10% 10%, rgba(0,229,255,0.06), transparent), radial-gradient(1000px 500px at 90% 90%, rgba(124,58,237,0.12), transparent), #020214' : '';
});
</script>
</body>
</html>
